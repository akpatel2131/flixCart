{"ast":null,"code":"import{Input,message}from\"antd\";import React,{useState,useRef,useEffect}from\"react\";import{withRouter}from\"react-router-dom\";import{config}from\"../App\";import Cart from\"./Cart\";import Header from\"./Header\";import Product from\"./Product\";import{Row,Col}from\"antd\";import Footer from\"./Footer\";import\"./Search.css\";const Search=props=>{const cartRef=useRef(null);const[debounceTimeout,setDebounceTimeout]=useState(0);const[products,setProducts]=useState([]);const[loading,setLoading]=useState(false);const[loggedIn,setLoggedIn]=useState(false);const[filteredProducts,setFilteredProducts]=useState([]);const validateResponse=(errored,response)=>{if(errored||!response.length&&!response.message){message.error(\"Could not fetch products. Check that the backend is running, reachable and returns valid JSON.\");return false;}if(!response.length){message.error(response.message||\"No products found in database\");return false;}return true;};const performAPICall=async()=>{let response={};let errored=false;setLoading(true);try{response=await(await fetch(\"\".concat(config.endpoint,\"/products\"))).json();}catch(e){errored=true;}setLoading(false);if(validateResponse(errored,response)){return response;}};const debounceSearch=event=>{const value=event.target.value;if(debounceTimeout){clearTimeout(debounceTimeout);}setDebounceTimeout(setTimeout(()=>{search(value);},300));};const search=text=>{setFilteredProducts(products.filter(product=>product.name.toUpperCase().includes(text.toUpperCase())||product.category.toUpperCase().includes(text.toUpperCase())));};const getProducts=async()=>{const response=await performAPICall();if(response){setProducts(response);setFilteredProducts(response.slice());}};useEffect(()=>{getProducts();if(localStorage.getItem(\"email\")&&localStorage.getItem(\"token\")){setLoggedIn(true);}},[]);const getProductElement=product=>{return/*#__PURE__*/React.createElement(Col,{xs:24,sm:12,xl:6,key:product._id},/*#__PURE__*/React.createElement(Product,{product:product,addToCart:()=>{if(loggedIn){cartRef.current.postToCart(product._id,1,true);}else{props.history.push(\"/login\");}}}));};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,{history:props.history},/*#__PURE__*/React.createElement(Input.Search,{placeholder:\"Search\",onSearch:search,onChange:debounceSearch,enterButton:true})),/*#__PURE__*/React.createElement(Row,{justify:\"center\"},/*#__PURE__*/React.createElement(Col,{xs:{span:24},xl:{span:loggedIn&&products.length?18:24}},/*#__PURE__*/React.createElement(\"div\",{className:\"search-container \"},/*#__PURE__*/React.createElement(Row,null,products.length!==0?filteredProducts.map(product=>getProductElement(product)):loading?/*#__PURE__*/React.createElement(\"div\",{className:\"loading-text\"},\"Loading products...\"):/*#__PURE__*/React.createElement(\"div\",{className:\"loading-text\"},\"No products to list\")))),loggedIn&&products.length&&/*#__PURE__*/React.createElement(Col,{xs:{span:24},md:{span:12},xl:{span:6},className:\"search-cart\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Cart,{ref:cartRef,products:products,history:props.history,token:localStorage.getItem(\"token\")})))),/*#__PURE__*/React.createElement(Footer,null));};export default withRouter(Search);","map":{"version":3,"names":["Input","message","React","useState","useRef","useEffect","withRouter","config","Cart","Header","Product","Row","Col","Footer","Search","props","cartRef","debounceTimeout","setDebounceTimeout","products","setProducts","loading","setLoading","loggedIn","setLoggedIn","filteredProducts","setFilteredProducts","validateResponse","errored","response","length","error","performAPICall","fetch","concat","endpoint","json","e","debounceSearch","event","value","target","clearTimeout","setTimeout","search","text","filter","product","name","toUpperCase","includes","category","getProducts","slice","localStorage","getItem","getProductElement","createElement","xs","sm","xl","key","_id","addToCart","current","postToCart","history","push","Fragment","placeholder","onSearch","onChange","enterButton","justify","span","className","map","md","ref","token"],"sources":["/Users/krunal/Desktop/Crio project/Fullstack/Flix-cart/Frontend/src/components/Search.js"],"sourcesContent":["import { Input, message } from \"antd\";\nimport React, {useState, useRef, useEffect} from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { config } from \"../App\";\n\nimport Cart from \"./Cart\";\n\nimport Header from \"./Header\";\nimport Product from \"./Product\";\nimport { Row, Col } from \"antd\";\nimport Footer from \"./Footer\";\nimport \"./Search.css\";\n\nconst Search = (props) => {\n  const cartRef = useRef(null);\n  const [debounceTimeout, setDebounceTimeout] = useState(0);\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [filteredProducts, setFilteredProducts] = useState([]);\n\n  const validateResponse = (errored, response) => {\n    if (errored || (!response.length && !response.message)) {\n      message.error(\n        \"Could not fetch products. Check that the backend is running, reachable and returns valid JSON.\"\n      );\n      return false;\n    }\n\n    if (!response.length) {\n      message.error(response.message || \"No products found in database\");\n      return false;\n    }\n\n    return true;\n  };\n\n  const performAPICall = async () => {\n    let response = {};\n    let errored = false;\n\n    setLoading(true);\n\n    try {\n      response = await (await fetch(`${config.endpoint}/products`)).json();\n    } catch (e) {\n      errored = true;\n    }\n\n    setLoading(false);\n\n    if (validateResponse(errored, response)) {\n      return response;\n    }\n  };\n\n  const debounceSearch = (event) => {\n    const value = event.target.value;\n\n    if (debounceTimeout) {\n      clearTimeout(debounceTimeout);\n    }\n\n    setDebounceTimeout(setTimeout(() => {\n      search(value);\n    }, 300));\n  };\n\n  const search = (text) => {\n    setFilteredProducts(products.filter(\n      (product) =>\n        product.name.toUpperCase().includes(text.toUpperCase()) ||\n        product.category.toUpperCase().includes(text.toUpperCase())\n    ));\n  };\n\n  const getProducts = async () => {\n    const response = await performAPICall();\n\n    if (response) {\n      setProducts(response);\n      setFilteredProducts(response.slice());\n    }\n  };\n\n  useEffect(() => {\n    getProducts();\n\n    if (localStorage.getItem(\"email\") && localStorage.getItem(\"token\")) {\n      setLoggedIn(true);\n    }\n  }, []);\n\n  const getProductElement = (product) => {\n    return (\n      <Col xs={24} sm={12} xl={6} key={product._id}>\n        <Product\n          product={product}\n          addToCart={() => {\n            if (loggedIn) {\n              cartRef.current.postToCart(product._id, 1, true);\n            } else {\n              props.history.push(\"/login\");\n            }\n          }}\n        />\n      </Col>\n    );\n  };\n\n  return (\n    <>\n      {/* Display Header with Search bar */}\n      <Header history={props.history}>\n        <Input.Search\n          placeholder=\"Search\"\n          onSearch={search}\n          onChange={debounceSearch}\n          enterButton={true}\n        />\n      </Header>\n\n      {/* Use Antd Row/Col components to display products and cart as columns in the same row*/}\n      <Row justify=\"center\">\n        {/* Display products */}\n        <Col\n          xs={{ span: 24 }}\n          xl={{ span: loggedIn && products.length ? 18 : 24 }}\n        >\n          <div className=\"search-container \">\n            {/* Display each product item wrapped in a Col component */}\n            <Row>\n              {products.length !== 0 ? (\n                filteredProducts.map((product) =>\n                  getProductElement(product)\n                )\n              ) : loading ? (\n                <div className=\"loading-text\">Loading products...</div>\n              ) : (\n                <div className=\"loading-text\">No products to list</div>\n              )}\n            </Row>\n          </div>\n        </Col>\n\n        {/* Display cart */}\n        {loggedIn && products.length && (\n          <Col xs={{ span: 24 }} md={{ span: 12 }} xl={{ span: 6 }} className=\"search-cart\">\n            <div>\n              <Cart\n                ref={cartRef}\n                products={products}\n                history={props.history}\n                token={localStorage.getItem(\"token\")}\n              />\n            </div>\n          </Col>\n        )}\n      </Row>\n\n      {/* Display the footer */}\n      <Footer />\n    </>\n  );\n}\n\nexport default withRouter(Search);\n\n"],"mappings":"AAAA,OAASA,KAAK,CAAEC,OAAO,KAAQ,MAAM,CACrC,MAAO,CAAAC,KAAK,EAAGC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,KAAO,OAAO,CACxD,OAASC,UAAU,KAAQ,kBAAkB,CAC7C,OAASC,MAAM,KAAQ,QAAQ,CAE/B,MAAO,CAAAC,IAAI,KAAM,QAAQ,CAEzB,MAAO,CAAAC,MAAM,KAAM,UAAU,CAC7B,MAAO,CAAAC,OAAO,KAAM,WAAW,CAC/B,OAASC,GAAG,CAAEC,GAAG,KAAQ,MAAM,CAC/B,MAAO,CAAAC,MAAM,KAAM,UAAU,CAC7B,MAAO,cAAc,CAErB,KAAM,CAAAC,MAAM,CAAIC,KAAK,EAAK,CACxB,KAAM,CAAAC,OAAO,CAAGZ,MAAM,CAAC,IAAI,CAAC,CAC5B,KAAM,CAACa,eAAe,CAAEC,kBAAkB,CAAC,CAAGf,QAAQ,CAAC,CAAC,CAAC,CACzD,KAAM,CAACgB,QAAQ,CAAEC,WAAW,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACkB,OAAO,CAAEC,UAAU,CAAC,CAAGnB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACoB,QAAQ,CAAEC,WAAW,CAAC,CAAGrB,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAACsB,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGvB,QAAQ,CAAC,EAAE,CAAC,CAE5D,KAAM,CAAAwB,gBAAgB,CAAGA,CAACC,OAAO,CAAEC,QAAQ,GAAK,CAC9C,GAAID,OAAO,EAAK,CAACC,QAAQ,CAACC,MAAM,EAAI,CAACD,QAAQ,CAAC5B,OAAQ,CAAE,CACtDA,OAAO,CAAC8B,KAAK,CACX,gGACF,CAAC,CACD,MAAO,MAAK,CACd,CAEA,GAAI,CAACF,QAAQ,CAACC,MAAM,CAAE,CACpB7B,OAAO,CAAC8B,KAAK,CAACF,QAAQ,CAAC5B,OAAO,EAAI,+BAA+B,CAAC,CAClE,MAAO,MAAK,CACd,CAEA,MAAO,KAAI,CACb,CAAC,CAED,KAAM,CAAA+B,cAAc,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CAAAH,QAAQ,CAAG,CAAC,CAAC,CACjB,GAAI,CAAAD,OAAO,CAAG,KAAK,CAEnBN,UAAU,CAAC,IAAI,CAAC,CAEhB,GAAI,CACFO,QAAQ,CAAG,KAAM,CAAC,KAAM,CAAAI,KAAK,IAAAC,MAAA,CAAI3B,MAAM,CAAC4B,QAAQ,aAAW,CAAC,EAAEC,IAAI,CAAC,CAAC,CACtE,CAAE,MAAOC,CAAC,CAAE,CACVT,OAAO,CAAG,IAAI,CAChB,CAEAN,UAAU,CAAC,KAAK,CAAC,CAEjB,GAAIK,gBAAgB,CAACC,OAAO,CAAEC,QAAQ,CAAC,CAAE,CACvC,MAAO,CAAAA,QAAQ,CACjB,CACF,CAAC,CAED,KAAM,CAAAS,cAAc,CAAIC,KAAK,EAAK,CAChC,KAAM,CAAAC,KAAK,CAAGD,KAAK,CAACE,MAAM,CAACD,KAAK,CAEhC,GAAIvB,eAAe,CAAE,CACnByB,YAAY,CAACzB,eAAe,CAAC,CAC/B,CAEAC,kBAAkB,CAACyB,UAAU,CAAC,IAAM,CAClCC,MAAM,CAACJ,KAAK,CAAC,CACf,CAAC,CAAE,GAAG,CAAC,CAAC,CACV,CAAC,CAED,KAAM,CAAAI,MAAM,CAAIC,IAAI,EAAK,CACvBnB,mBAAmB,CAACP,QAAQ,CAAC2B,MAAM,CAChCC,OAAO,EACNA,OAAO,CAACC,IAAI,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACL,IAAI,CAACI,WAAW,CAAC,CAAC,CAAC,EACvDF,OAAO,CAACI,QAAQ,CAACF,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACL,IAAI,CAACI,WAAW,CAAC,CAAC,CAC9D,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAAAG,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,KAAM,CAAAvB,QAAQ,CAAG,KAAM,CAAAG,cAAc,CAAC,CAAC,CAEvC,GAAIH,QAAQ,CAAE,CACZT,WAAW,CAACS,QAAQ,CAAC,CACrBH,mBAAmB,CAACG,QAAQ,CAACwB,KAAK,CAAC,CAAC,CAAC,CACvC,CACF,CAAC,CAEDhD,SAAS,CAAC,IAAM,CACd+C,WAAW,CAAC,CAAC,CAEb,GAAIE,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAID,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAE,CAClE/B,WAAW,CAAC,IAAI,CAAC,CACnB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAgC,iBAAiB,CAAIT,OAAO,EAAK,CACrC,mBACE7C,KAAA,CAAAuD,aAAA,CAAC7C,GAAG,EAAC8C,EAAE,CAAE,EAAG,CAACC,EAAE,CAAE,EAAG,CAACC,EAAE,CAAE,CAAE,CAACC,GAAG,CAAEd,OAAO,CAACe,GAAI,eAC3C5D,KAAA,CAAAuD,aAAA,CAAC/C,OAAO,EACNqC,OAAO,CAAEA,OAAQ,CACjBgB,SAAS,CAAEA,CAAA,GAAM,CACf,GAAIxC,QAAQ,CAAE,CACZP,OAAO,CAACgD,OAAO,CAACC,UAAU,CAAClB,OAAO,CAACe,GAAG,CAAE,CAAC,CAAE,IAAI,CAAC,CAClD,CAAC,IAAM,CACL/C,KAAK,CAACmD,OAAO,CAACC,IAAI,CAAC,QAAQ,CAAC,CAC9B,CACF,CAAE,CACH,CACE,CAAC,CAEV,CAAC,CAED,mBACEjE,KAAA,CAAAuD,aAAA,CAAAvD,KAAA,CAAAkE,QAAA,mBAEElE,KAAA,CAAAuD,aAAA,CAAChD,MAAM,EAACyD,OAAO,CAAEnD,KAAK,CAACmD,OAAQ,eAC7BhE,KAAA,CAAAuD,aAAA,CAACzD,KAAK,CAACc,MAAM,EACXuD,WAAW,CAAC,QAAQ,CACpBC,QAAQ,CAAE1B,MAAO,CACjB2B,QAAQ,CAAEjC,cAAe,CACzBkC,WAAW,CAAE,IAAK,CACnB,CACK,CAAC,cAGTtE,KAAA,CAAAuD,aAAA,CAAC9C,GAAG,EAAC8D,OAAO,CAAC,QAAQ,eAEnBvE,KAAA,CAAAuD,aAAA,CAAC7C,GAAG,EACF8C,EAAE,CAAE,CAAEgB,IAAI,CAAE,EAAG,CAAE,CACjBd,EAAE,CAAE,CAAEc,IAAI,CAAEnD,QAAQ,EAAIJ,QAAQ,CAACW,MAAM,CAAG,EAAE,CAAG,EAAG,CAAE,eAEpD5B,KAAA,CAAAuD,aAAA,QAAKkB,SAAS,CAAC,mBAAmB,eAEhCzE,KAAA,CAAAuD,aAAA,CAAC9C,GAAG,MACDQ,QAAQ,CAACW,MAAM,GAAK,CAAC,CACpBL,gBAAgB,CAACmD,GAAG,CAAE7B,OAAO,EAC3BS,iBAAiB,CAACT,OAAO,CAC3B,CAAC,CACC1B,OAAO,cACTnB,KAAA,CAAAuD,aAAA,QAAKkB,SAAS,CAAC,cAAc,EAAC,qBAAwB,CAAC,cAEvDzE,KAAA,CAAAuD,aAAA,QAAKkB,SAAS,CAAC,cAAc,EAAC,qBAAwB,CAErD,CACF,CACF,CAAC,CAGLpD,QAAQ,EAAIJ,QAAQ,CAACW,MAAM,eAC1B5B,KAAA,CAAAuD,aAAA,CAAC7C,GAAG,EAAC8C,EAAE,CAAE,CAAEgB,IAAI,CAAE,EAAG,CAAE,CAACG,EAAE,CAAE,CAAEH,IAAI,CAAE,EAAG,CAAE,CAACd,EAAE,CAAE,CAAEc,IAAI,CAAE,CAAE,CAAE,CAACC,SAAS,CAAC,aAAa,eAC/EzE,KAAA,CAAAuD,aAAA,yBACEvD,KAAA,CAAAuD,aAAA,CAACjD,IAAI,EACHsE,GAAG,CAAE9D,OAAQ,CACbG,QAAQ,CAAEA,QAAS,CACnB+C,OAAO,CAAEnD,KAAK,CAACmD,OAAQ,CACvBa,KAAK,CAAEzB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE,CACtC,CACE,CACF,CAEJ,CAAC,cAGNrD,KAAA,CAAAuD,aAAA,CAAC5C,MAAM,KAAE,CACT,CAAC,CAEP,CAAC,CAED,cAAe,CAAAP,UAAU,CAACQ,MAAM,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}